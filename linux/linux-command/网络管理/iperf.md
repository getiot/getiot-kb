---
sidebar_label: iperf 命令
sidebar_position: 17
slug: /iperf
---

# Linux iperf 命令 - 网络带宽测试工具



## 介绍

**iperf** 是一个 Linux 网络性能测试命令行工具。可用于测试 TCP 和 UDP 带宽质量，例如最大 TCP 带宽等多种参数特性，报告带宽、延迟抖动和数据包丢失。因此，我们常常利用 iperf 工具来来测试一些网络设备的性能，如路由器、防火墙、交换机等。

Linux 系统通常默认不安装 iperf 工具，在 Debian/Ubuntu 系统上可以使用如下命令进行安装。

```bash
sudo apt install iperf
```

另外还有一个 iperf3 工具，和 iperf 的区别是它不支持双工模式测试。

**语法**：

```bash
iperf [-s|-c host] [options]
iperf [-h|--help] [-v|--version]
```

**选项**：

- `-f`, `--format [abkmgBKMG]`：格式化带宽数输出。每个字母分别对应：adaptive、bits、Bytes、Kbits、Mbits、Gbits、KBytes、MBytes、GBytes，默认参数是 a，即自适应。值得注意的是，在计算字节 byte 时，Kilo = 1024，Mega = 1024^2，Giga = 1024^3。通常在网络中，Kilo = 1000，Mega = 1000^2，Giga = 1000^3，所以 iperf 也按此来计算比特（位）。如果这些困扰了你，那么请使用 `-f b` 参数，然后亲自计算一下。 
- `-i`, `--interval`：设置每次报告之间的时间间隔，单位为秒。如果设置为非零值，就会按照此时间间隔输出测试报告。默认值为零。 
- `-l`, `--len n[kmKM]`：设置读写缓冲区的长度。TCP 方式默认为 8KB，UDP 方式默认为 1470 字节。 
- `-m`, `--print_mss`：输出 TCP 的 MSS 值（MSS 全称是 maximum segment size，通过 `TCP_MAXSEG` 支持）。通常情况下，MSS 值比 MTU 值小 40 字节。
- `-p`, `--port`：设置端口，与服务器端的监听端口一致。默认使用 5001 端口。
- `-u`, `--udp`：使用 UDP 方式而不是 TCP 方式。
- `-w`, `--window n[kmKM]`：设置套接字缓冲区为指定大小。对于 TCP 方式，此设置为 TCP 窗口大小。对于 UDP 方式，此设置为接受 UDP 数据包的缓冲区大小，限制可以接受数据包的最大值。 
- `-B`, `--bind host`：绑定到主机的多个地址中的一个。对于客户端来说，这个参数设置了出栈接口。对于服务器端来说，这个参数设置入栈接口。这个参数只用于具有多网络接口的主机。在 iperf 的 UDP 模式下，此参数用于绑定和加入一个多播组。使用范围在 224.0.0.0 至 239.255.255.255 的多播地址。
- `-C`, `--compatibility`：与低版本的 iperf 使用时，可以使用兼容模式。不需要两端同时使用兼容模式，但是强烈推荐两端同时使用兼容模式。某些情况下，使用某些数据流可以引起1.7版本的服务器端崩溃或引起非预期的连接尝试。
- `-M`, `--mss`：ip 头减去 40 字节。在以太网中，MSS 值为 1460 字节（MTU 值为 1500 字节）。
- `-N`, `--nodelay`：设置 TCP 无延迟选项，禁用 Nagle's 运算法则。通常情况此选项对于交互程序，例如 telnet，是禁用的。
- `-V`, `--ipv6_domain`：绑定一个 IPv6 地址。 注意，在 1.6.3 或更高版本中，指定 IPv6 地址不需要使用 `-B` 参数绑定，在 1.6 之前的版本则需要。在大多数操作系统中，将响应 IPv4 客户端映射的 IPv4 地址。
- `-h`, `--help`：显示命令行参考并退出。
- `-v`, `--version`：显示版本信息和编译信息并退出。

**服务器端专用选项**：

- `-s`, `--server`：iperf 服务器模式 。
- `-D`：Unix 平台下 iperf 作为后台守护进程运行。在 Win32 平台下，iperf 将作为服务运行。 
- `-R`：卸载 iperf 服务（如果它在运行），仅用于 Windows 系统。
- `-o`：重定向输出到指定文件，仅用于 Windows 系统。
- `-c`, `--client host`：如果 iperf 运行在服务器模式，并且用 `-c` 参数指定一个主机，那么 `iperf` 将只接受指定主机的连接。此参数不能工作于 UDP 模式。
- `-P`, `--parallel`：服务器关闭之前保持的连接数。默认是 0，这意味着永远接受连接。

**客户端专用选项**：

- `-b`, `--bandwidth n[kmgKMG]`：UDP 模式使用的带宽，单位 bits/sec。此选项与 -u 选项相关。默认值是 1 Mbit/sec。
- `-c`, `--client host`：运行 iperf 的客户端模式，连接到指定的 iperf 服务器端。
- `-d`, `--dualtest`：运行双测试模式。这将使服务器端反向连接到客户端，使用 `-L` 参数中指定的端口（或默认使用客户端连接到服务器端的端口）。如果你想要一个交互的测试，请尝试 `-r` 参数。  
- `-n`, `--num n[kmKM]`：传送的缓冲器数量。通常情况，iperf 按照 10 秒钟发送数据。`-n` 参数跨越此限制，按照指定次数发送指定长度的数据，而不论该操作耗费多少时间。参考 `-l` 与 `-t` 选项。
- `-r`, `--tradeoff`：往复测试模式。当客户端到服务器端的测试结束时，服务器端通过 `-l` 选项指定的端口（或默认为客户端连接到服务器端的端口），反向连接至客户端。当客户端连接终止时，反向连接随即开始。如果需要同时进行双向测试，请尝试 `-d` 参数。
- `-t`, `--time`：设置传输的总时间。iperf 在指定的时间内，重复的发送指定长度的数据包。默认是 10 秒钟。参考 `-l` 与 `-n` 选项。
- `-L`, `--listenport`：指定服务端反向连接到客户端时使用的端口。默认使用客户端连接至服务端的端口。
- `-P`, `--parallel`：指定客户端与服务端之间使用的线程数，默认是 1 线程。需要客户端与服务器端同时使用此参数。
- `-S`, `--tos`：出栈数据包的服务类型，不过许多路由器都忽略 TOS 字段。你可以指定这个值，使用以 "0x" 开始的 16 进制数，或以 "0" 开始的 8 进制数或 10 进制数。例如，十六进制 '0x10' = 八进制 '020' = 十进制 '16'。
- `-T`, `--ttl`：出栈多播数据包的 TTL 值。这本质上就是数据通过路由器的跳数。默认是 1，链接本地。
- `-F`：使用特定的数据流测量带宽，例如指定的文件。



## 示例

### UDP 模式

启动 UDP 服务器端

```bash
iperf -u -s
```

启动 UDP 客户端，以 100Mbps 为数据发送速率，测试时间为 60 秒。

```bash
iperf -u -c 192.168.0.1 -b 100M -t 60
```

在 UDP 模式下，以 100M 为数据发送速率，进行上下行带宽测试。

```bash
iperf -u -c 192.168.0.1 -b 100M -d -t 60
```

在 UDP 模式下，客户端同时向服务器端发起 30 个连接线程，以 5Mbps 为数据发送速率。

```bash
iperf -u -c 192.168.0.1 -b 5M -P 30 -t 60
```



### TCP 模式

启动 TCP 服务器端

```bash
iperf -s
```

启动 TCP 客户端，连接到 192.168.0.1 服务器，进行上传带宽测试，测试时间为 60 秒。

```bash
iperf -c 192.168.0.1 -t 60
```

在 TCP 模式下，进行上下行带宽测试。

```bash
iperf -c 192.168.0.1 -d -t 60
```

在 TCP 模式下，客户端同时向服务器端发起 30 个连接线程。

```bash
iperf -c 192.168.0.1 -P 30 -t 60
```



